---
title: "STAA57 W21 - Project Proposal"
author:  "Group #? (Adham F, Jason Y, Mohamed T, Wesley M)"
output: html_document
---

#### Analysis Plan 

1. Specify the questions you will address. Describe the general topic of your investigation, and state specific questions you will address. Include any relevant information.

2. Specify your data analysis plan. Describe (in words) how you will address these questions using data.


#### Data 
```{r, include=FALSE, warning=FALSE}
source(file = "preprocess_data.R")
```
3. Specify your data sources, and the type of information you will use (for external data, provide links/references). For each data source, describe the variables and observations used in your analysis. Identify any potential issues (e.g. bias). 

4. Provide the R code that imports the data into R, and formats them appropriately (this can go to the appendix if it is too lengthy). Submit a copy of your external data files, if any. 


#### Preliminary Results

5. Create at least three data summaries/visualisations which are relevant to your questions, and comment on your results. 

```{r}
getSeason <- function(month) {
    ifelse(month >= 3 & month <= 5, "Spring",
           ifelse(month >= 6 & month <= 8, "Summer",
                  ifelse(month >= 9 & month <= 11, "Fall", "Winter")))
}
```

```{r}
data_with_season <- clean_data_processed %>%
  mutate(season = getSeason(Month))
```

```{r}
# calculating the demand of the flight training
data_with_covid <- data_with_season %>% 
  mutate(during_covid = Year >= 2020)
```

```{r}
# Duration By Month (2016 - 2019 vs 2020) | Side by Side Bar Chart
data_with_covid %>%
  distinct(Training_Type, Session_ID, .keep_all = T) %>%
  mutate_if(is.numeric, replace_na, 0) %>%
  group_by(Month, during_covid, Year) %>%
  summarise(total_duration = sum(Duration)) %>%
  summarise(avg_duration_per_month = mean(total_duration)) %>%
  ggplot(aes(x=factor(month.abb[Month], level=month.abb), y=avg_duration_per_month, fill=during_covid)) + 
  geom_bar(position="dodge", stat="identity") +
  xlab('Month') + ylab('Duration') +
  labs(title='Avg Duration Per Month')
```

```{r}
# Duration By Month  | Total Bar Chart
data_with_covid %>%
  distinct(Training_Type, Session_ID, .keep_all = T) %>%
  mutate_if(is.numeric, replace_na, 0) %>%
  group_by(Month, Year) %>%
  summarise(total_duration = sum(Duration)) %>%
  summarise(avg_duration_per_month = mean(total_duration)) %>%
  ggplot(aes(x=factor(month.abb[Month], level=month.abb), y=avg_duration_per_month)) + 
  geom_bar(position="dodge", stat="identity") +
  xlab('Month') + ylab('Duration') +
  labs(title='Avg Duration Per Month')
```

```{r}
# Duration By Season (2016 - 2019 vs 2020) | Side by Side Bar Chart
data_with_covid %>%
  distinct(Training_Type, Session_ID, .keep_all = T) %>%
  mutate_if(is.numeric, replace_na, 0) %>%
  group_by(season, during_covid, Year) %>%
  summarise(total_duration = sum(Duration)) %>%
  summarise(avg_duration_per_month = mean(total_duration)) %>%
  ggplot(aes(x=factor(season, level=c('Winter', 'Spring', 'Summer', 'Fall')), y=avg_duration_per_month, fill=during_covid)) + 
  geom_bar(position="dodge", stat="identity") +
  xlab('Month') + ylab('Duration') +
  labs(title='Avg Duration Per Month')
```
```{r}
# Duration By Season | Total Bar Chart
data_with_covid %>%
  distinct(Training_Type, Session_ID, .keep_all = T) %>%
  mutate_if(is.numeric, replace_na, 0) %>%
  group_by(season, Year) %>%
  summarise(total_duration = sum(Duration)) %>%
  summarise(avg_duration_per_month = mean(total_duration)) %>%
  ggplot(aes(x=factor(season, level=c('Winter', 'Spring', 'Summer', 'Fall')), y=avg_duration_per_month)) + 
  geom_bar(position="dodge", stat="identity") +
  xlab('Month') + ylab('Duration') +
  labs(title='Avg Duration Per Month')
```

